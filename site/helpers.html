<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>vcat.helpers - vcat</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "vcat.helpers";
        var mkdocs_page_input_path = "helpers.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> vcat
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">VCAT Documention</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Example Notebooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorial Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/ImageDataPlots.html">Plotting Images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/ImageOperations.html">Modifying Images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/ImageCubePlots.html">Plotting ImageCubes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/ImageCubeOperations.html">Modifying ImageCubes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/Alignment.html">Alignment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/ModelComponents.html">Model Component Analysis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/Ridgeline.html">Ridgeline Fitting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/Stacking.html">Stacking</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/TurnoverFrequency.html">Turnover Frequency</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Code Documentation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="overview.html">Code Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="imagedata.html">ImageData</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="imagecube.html">ImageCube</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">vcat.helpers</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers">helpers</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.Jy2JyPerBeam">Jy2JyPerBeam</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.JyPerBeam2Jy">JyPerBeam2Jy</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.PXPERBEAM">PXPERBEAM</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.calculate_beam_width">calculate_beam_width</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.convolve_with_elliptical_gaussian">convolve_with_elliptical_gaussian</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.elliptical_gaussian_kernel">elliptical_gaussian_kernel</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.fit_width">fit_width</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.func_turn">func_turn</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.getComponentInfo">getComponentInfo</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.getMinVolEllipse">getMinVolEllipse</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.get_common_beam">get_common_beam</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.get_comp_peak_rms">get_comp_peak_rms</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.get_date">get_date</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.get_noise_from_residual_map">get_noise_from_residual_map</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.get_residual_map">get_residual_map</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.get_uvf_frequency">get_uvf_frequency</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.mas2pc">mas2pc</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.plot_pixel_fit">plot_pixel_fit</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.rotate_points">rotate_points</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.set_figsize">set_figsize</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.total_flux_from_mod">total_flux_from_mod</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.wrap_evpas">wrap_evpas</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.write_mod_file">write_mod_file</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.write_mod_file_from_casa">write_mod_file_from_casa</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcat.helpers.write_mod_file_from_components">write_mod_file_from_components</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="license.html">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="release-note.html">Release Notes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">vcat</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Code Documentation</li>
      <li class="breadcrumb-item active">vcat.helpers</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/mpifr-vlbi/VCAT/edit/master/docs/helpers.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="the-vcathelpers">The vcat.helpers</h1>
<p>The vcat.helpers submodule includes several useful tools to modify VLBI data.</p>


<div class="doc doc-object doc-module">



<a id="vcat.helpers"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.Jy2JyPerBeam" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">Jy2JyPerBeam</span><span class="p">(</span><span class="n">jpp</span><span class="p">,</span> <span class="n">b_maj</span><span class="p">,</span> <span class="n">b_min</span><span class="p">,</span> <span class="n">px_inc</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Converts Jy/px to Jy/beam</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>jpp</code></b>
              â€“
              <div class="doc-md-description">
                <p>Jansky per pixel</p>
              </div>
            </li>
            <li>
              <b><code>b_maj</code></b>
              â€“
              <div class="doc-md-description">
                <p>Major Axis</p>
              </div>
            </li>
            <li>
              <b><code>b_min</code></b>
              â€“
              <div class="doc-md-description">
                <p>Minor Axis</p>
              </div>
            </li>
            <li>
              <b><code>px_inc</code></b>
              â€“
              <div class="doc-md-description">
                <p>pixel size</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>jpb</code></b>              â€“
              <div class="doc-md-description">
                <p>Jansky per pixel value</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Jy2JyPerBeam</span><span class="p">(</span><span class="n">jpp</span><span class="p">,</span><span class="n">b_maj</span><span class="p">,</span><span class="n">b_min</span><span class="p">,</span><span class="n">px_inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts Jy/px to Jy/beam</span>

<span class="sd">        Args:</span>
<span class="sd">            jpp: Jansky per pixel</span>
<span class="sd">            b_maj: Major Axis</span>
<span class="sd">            b_min: Minor Axis</span>
<span class="sd">            px_inc: pixel size</span>

<span class="sd">        Returns:</span>
<span class="sd">            jpb: Jansky per pixel value</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">jpp</span><span class="o">*</span><span class="n">PXPERBEAM</span><span class="p">(</span><span class="n">b_maj</span><span class="p">,</span><span class="n">b_min</span><span class="p">,</span><span class="n">px_inc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.JyPerBeam2Jy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">JyPerBeam2Jy</span><span class="p">(</span><span class="n">jpb</span><span class="p">,</span> <span class="n">b_maj</span><span class="p">,</span> <span class="n">b_min</span><span class="p">,</span> <span class="n">px_inc</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Converts Jy/beam to Jy</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>jbp</code></b>
              â€“
              <div class="doc-md-description">
                <p>Jansky per beam value</p>
              </div>
            </li>
            <li>
              <b><code>b_maj</code></b>
              â€“
              <div class="doc-md-description">
                <p>Major Axis</p>
              </div>
            </li>
            <li>
              <b><code>b_min</code></b>
              â€“
              <div class="doc-md-description">
                <p>Minor Axis</p>
              </div>
            </li>
            <li>
              <b><code>px_inc</code></b>
              â€“
              <div class="doc-md-description">
                <p>pixel size</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>jy</code></b>              â€“
              <div class="doc-md-description">
                <p>Jansky value</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">JyPerBeam2Jy</span><span class="p">(</span><span class="n">jpb</span><span class="p">,</span><span class="n">b_maj</span><span class="p">,</span><span class="n">b_min</span><span class="p">,</span><span class="n">px_inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts Jy/beam to Jy</span>

<span class="sd">    Args:</span>
<span class="sd">        jbp: Jansky per beam value</span>
<span class="sd">        b_maj: Major Axis</span>
<span class="sd">        b_min: Minor Axis</span>
<span class="sd">        px_inc: pixel size</span>

<span class="sd">    Returns:</span>
<span class="sd">        jy: Jansky value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">jpb</span><span class="o">/</span><span class="n">PXPERBEAM</span><span class="p">(</span><span class="n">b_maj</span><span class="p">,</span><span class="n">b_min</span><span class="p">,</span><span class="n">px_inc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.PXPERBEAM" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PXPERBEAM</span><span class="p">(</span><span class="n">b_maj</span><span class="p">,</span> <span class="n">b_min</span><span class="p">,</span> <span class="n">px_inc</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>calculates the pixels per beam.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>b_maj</code></b>
              â€“
              <div class="doc-md-description">
                <p>major axis</p>
              </div>
            </li>
            <li>
              <b><code>b_min</code></b>
              â€“
              <div class="doc-md-description">
                <p>minor axis</p>
              </div>
            </li>
            <li>
              <b><code>px_inc</code></b>
              â€“
              <div class="doc-md-description">
                <p>pixel size</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>ppb</code></b>              â€“
              <div class="doc-md-description">
                <p>pixels per beam</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">PXPERBEAM</span><span class="p">(</span><span class="n">b_maj</span><span class="p">,</span><span class="n">b_min</span><span class="p">,</span><span class="n">px_inc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculates the pixels per beam.</span>

<span class="sd">    Args:</span>
<span class="sd">        b_maj: major axis</span>
<span class="sd">        b_min: minor axis</span>
<span class="sd">        px_inc: pixel size</span>

<span class="sd">    Returns:</span>
<span class="sd">        ppb: pixels per beam</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">beam_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">b_min</span><span class="o">*</span><span class="n">b_maj</span>
    <span class="n">PXPERBEAM</span> <span class="o">=</span> <span class="n">beam_area</span><span class="o">/</span><span class="p">(</span><span class="n">px_inc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PXPERBEAM</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.calculate_beam_width" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_beam_width</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">beam_maj</span><span class="p">,</span> <span class="n">beam_min</span><span class="p">,</span> <span class="n">beam_pa</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate width of a beam at a certain angle</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>angle</code></b>
              â€“
              <div class="doc-md-description">
                <p>Angle in degrees</p>
              </div>
            </li>
            <li>
              <b><code>beam_maj</code></b>
              â€“
              <div class="doc-md-description">
                <p>Beam major axis length</p>
              </div>
            </li>
            <li>
              <b><code>beam_min</code></b>
              â€“
              <div class="doc-md-description">
                <p>beam minor axis length</p>
              </div>
            </li>
            <li>
              <b><code>beam_pa</code></b>
              â€“
              <div class="doc-md-description">
                <p>beam position angle in degrees</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>beam_width</code></b>              â€“
              <div class="doc-md-description">
                <p>Width at the given angle</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_beam_width</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">beam_maj</span><span class="p">,</span> <span class="n">beam_min</span><span class="p">,</span> <span class="n">beam_pa</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate width of a beam at a certain angle</span>

<span class="sd">    Args:</span>
<span class="sd">        angle: Angle in degrees</span>
<span class="sd">        beam_maj: Beam major axis length</span>
<span class="sd">        beam_min: beam minor axis length</span>
<span class="sd">        beam_pa: beam position angle in degrees</span>

<span class="sd">    Returns:</span>
<span class="sd">        beam_width: Width at the given angle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_pos</span><span class="o">=</span><span class="n">beam_pa</span><span class="o">-</span><span class="n">angle</span>

    <span class="n">beam</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">hradius</span><span class="o">=</span><span class="n">beam_maj</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">vradius</span><span class="o">=</span><span class="n">beam_min</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">new_pos</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">new_pos</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">width</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.convolve_with_elliptical_gaussian" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convolve_with_elliptical_gaussian</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convolves a 2D image with an elliptical Gaussian kernel.</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convolve_with_elliptical_gaussian</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convolves a 2D image with an elliptical Gaussian kernel.&quot;&quot;&quot;</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">elliptical_gaussian_kernel</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">convolved</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">convolved</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.elliptical_gaussian_kernel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">elliptical_gaussian_kernel</span><span class="p">(</span><span class="n">size_x</span><span class="p">,</span> <span class="n">size_y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate an elliptical Gaussian kernel with rotation.</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">elliptical_gaussian_kernel</span><span class="p">(</span><span class="n">size_x</span><span class="p">,</span> <span class="n">size_y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an elliptical Gaussian kernel with rotation.&quot;&quot;&quot;</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size_y</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_y</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size_x</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_x</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_x</span><span class="p">))</span>

    <span class="c1"># Rotation matrix</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">x_rot</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">y_rot</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="c1"># Elliptical Gaussian formula</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x_rot</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_rot</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">g</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>  <span class="c1"># Normalize the kernel</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.fit_width" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit_width</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">width_err</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dist_err</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fit_type</span><span class="o">=</span><span class="s1">&#39;brokenPowerlaw&#39;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fit_r0</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Fit a power-law or broken-powerlaw to jet width</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit_width</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">width</span><span class="p">,</span>
                <span class="n">width_err</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">dist_err</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fit_type</span><span class="o">=</span><span class="s1">&#39;brokenPowerlaw&#39;</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fit_r0</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Fit a power-law or broken-powerlaw to jet width&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">x0</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fit_type</span><span class="o">==</span><span class="s1">&#39;brokenPowerlaw&#39;</span> <span class="ow">and</span> <span class="n">fit_r0</span><span class="p">:</span>
            <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fit_type</span><span class="o">==</span><span class="s1">&#39;brokenPowerlaw&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fit_type</span><span class="o">==</span><span class="s2">&quot;Powerlaw&quot;</span> <span class="ow">and</span> <span class="n">fit_r0</span><span class="p">:</span>
            <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fit_type</span><span class="o">==</span><span class="s2">&quot;Powerlaw&quot;</span><span class="p">:</span>
            <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please select valid fit_type (&#39;Powerlaw&#39;, &#39;brokenPowerlaw&#39;)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fit_type</span> <span class="o">==</span> <span class="s1">&#39;Powerlaw&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dist_err</span><span class="p">:</span>
            <span class="n">beta</span><span class="p">,</span><span class="n">sd_beta</span><span class="p">,</span><span class="n">chi2</span><span class="p">,</span><span class="n">out</span> <span class="o">=</span> <span class="n">fit_pl</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">width_err</span><span class="p">,</span><span class="n">sx</span><span class="o">=</span><span class="n">dist_err</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span><span class="n">fit_r0</span><span class="o">=</span><span class="n">fit_r0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta</span><span class="p">,</span><span class="n">sd_beta</span><span class="p">,</span><span class="n">chi2</span><span class="p">,</span><span class="n">out</span> <span class="o">=</span> <span class="n">fit_pl</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">width_err</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span><span class="n">fit_r0</span><span class="o">=</span><span class="n">fit_r0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fit_type</span><span class="o">==</span><span class="s1">&#39;brokenPowerlaw&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dist_err</span><span class="p">:</span>
            <span class="n">beta</span><span class="p">,</span><span class="n">sd_beta</span><span class="p">,</span><span class="n">chi2</span><span class="p">,</span><span class="n">out</span> <span class="o">=</span> <span class="n">fit_bpl</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">width_err</span><span class="p">,</span><span class="n">sx</span><span class="o">=</span><span class="n">dist_err</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span><span class="n">fit_r0</span><span class="o">=</span><span class="n">fit_r0</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta</span><span class="p">,</span><span class="n">sd_beta</span><span class="p">,</span><span class="n">chi2</span><span class="p">,</span><span class="n">out</span> <span class="o">=</span> <span class="n">fit_bpl</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">width_err</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span><span class="n">fit_r0</span><span class="o">=</span><span class="n">fit_r0</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">beta</span><span class="p">,</span> <span class="n">sd_beta</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.func_turn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">func_turn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">turn</span><span class="p">,</span> <span class="n">alpha0</span><span class="p">,</span> <span class="n">alphat</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Turnover frequency function.</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">func_turn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">turn</span><span class="p">,</span> <span class="n">alpha0</span><span class="p">,</span> <span class="n">alphat</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turnover frequency function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">i0</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">turn</span><span class="p">)</span><span class="o">**</span><span class="n">alphat</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">turn</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">alphat</span> <span class="o">-</span> <span class="n">alpha0</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.getComponentInfo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getComponentInfo</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Imports component info from a modelfit .fits or .mod file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path to a modelfit (or clean) .fits or .mod file</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>output</code></b>(                  <code><span title="DataFrame">DataFrame</span></code>
)              â€“
              <div class="doc-md-description">
                <p>Model data (Flux, Delta_x, Delta_y, Major Axis, Minor Axis, PA, Typ_obj)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getComponentInfo</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="n">year</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">mjd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">date</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Imports component info from a modelfit .fits or .mod file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Path to a modelfit (or clean) .fits or .mod file</span>

<span class="sd">    Returns:</span>
<span class="sd">        output (DataFrame): Model data (Flux, Delta_x, Delta_y, Major Axis, Minor Axis, PA, Typ_obj)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">is_fits_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="c1">#read in fits file</span>
        <span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">hdu_list</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">comp_data</span> <span class="o">=</span> <span class="n">hdu_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;FITS file does not contain model.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">comp_data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">mjd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">date1</span> <span class="o">=</span> <span class="n">get_date</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">date1</span><span class="p">)</span>
        <span class="n">tjyear</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">jyear</span>
        <span class="n">tmjd</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">mjd</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_data</span><span class="p">)):</span>
            <span class="n">comp_data1</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">comp_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date1</span><span class="p">)</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">tjyear</span><span class="p">)</span>
            <span class="n">mjd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="n">tmjd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#DIFMAP STYLE</span>
            <span class="n">comp_data1_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comp_data1</span><span class="p">,</span>
                                         <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Flux&quot;</span><span class="p">,</span> <span class="s2">&quot;Delta_x&quot;</span><span class="p">,</span> <span class="s2">&quot;Delta_y&quot;</span><span class="p">,</span> <span class="s2">&quot;Major_axis&quot;</span><span class="p">,</span> <span class="s2">&quot;Minor_axis&quot;</span><span class="p">,</span> <span class="s2">&quot;PA&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;Typ_obj&quot;</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1">#AIPS STYLE</span>
            <span class="n">comp_data1_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">comp_data1</span><span class="p">,</span>
                                         <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Flux&quot;</span><span class="p">,</span><span class="s2">&quot;Delta_x&quot;</span><span class="p">,</span><span class="s2">&quot;Delta_y&quot;</span><span class="p">])</span>
            <span class="n">comp_data1_df</span><span class="p">[</span><span class="s2">&quot;Major_axis&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">comp_data1_df</span><span class="p">[</span><span class="s2">&quot;Minor_axis&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">comp_data1_df</span><span class="p">[</span><span class="s2">&quot;PA&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">comp_data1_df</span><span class="p">[</span><span class="s2">&quot;Typ_obj&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

        <span class="n">comp_data1_df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span>
        <span class="n">comp_data1_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
        <span class="n">comp_data1_df</span><span class="p">[</span><span class="s2">&quot;mjd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mjd</span>
        <span class="n">comp_data1_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Delta_x&quot;</span><span class="p">,</span> <span class="s2">&quot;Delta_y&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">data_df</span> <span class="o">=</span> <span class="n">comp_data1_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_df</span><span class="p">,</span> <span class="n">comp_data1_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;tmp&quot;</span><span class="p">,</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#write Radius, ratio and Angle also to database</span>
        <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>

        <span class="c1"># Function to calculate &#39;theta&#39;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">calculate_theta</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">+</span> <span class="mi">180</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_x&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Delta_y&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">-</span> <span class="mi">180</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># Apply function to calculate &#39;theta&#39;</span>
        <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate_theta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Calculate &#39;ratio&#39;</span>
        <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Minor_axis&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Major_axis&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Major_axis&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                                     <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#will assume that the file is a .mod file</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">maj</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">typ_obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
                    <span class="n">linepart</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
                    <span class="c1">#other parameters might not be there, try</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maj</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
                        <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
                        <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
                        <span class="n">typ_obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typ_obj</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># in this case it is a gaussian model component</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maj</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">typ_obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typ_obj</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#in this case it is a clean component</span>
        <span class="c1">#import completed now calculate additional parameters:</span>
        <span class="n">delta_x</span><span class="o">=</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>
        <span class="n">delta_y</span><span class="o">=</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>
        <span class="n">maj</span><span class="o">=</span><span class="n">maj</span><span class="o">/</span><span class="n">scale</span>
        <span class="nb">min</span><span class="o">=</span><span class="n">ratio</span><span class="o">*</span><span class="n">maj</span>

        <span class="c1">#create data_df</span>
        <span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ratio&#39;</span><span class="p">:</span> <span class="n">ratio</span><span class="p">,</span> <span class="s1">&#39;Minor_axis&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span> <span class="s1">&#39;Major_axis&#39;</span><span class="p">:</span> <span class="n">maj</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="n">theta</span><span class="p">,</span> <span class="s1">&#39;Delta_y&#39;</span><span class="p">:</span> <span class="n">delta_y</span><span class="p">,</span>
                                <span class="s1">&#39;Delta_x&#39;</span><span class="p">:</span> <span class="n">delta_x</span> <span class="p">,</span><span class="s2">&quot;Flux&quot;</span><span class="p">:</span> <span class="n">flux</span><span class="p">,</span> <span class="s2">&quot;PA&quot;</span><span class="p">:</span> <span class="n">pa</span><span class="p">,</span> <span class="s2">&quot;Typ_obj&quot;</span><span class="p">:</span> <span class="n">typ_obj</span><span class="p">})</span>

        <span class="n">data_df</span><span class="p">[</span><span class="s2">&quot;mjd&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">mjd</span>
        <span class="n">data_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">year</span>
        <span class="n">data_df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">date</span>

    <span class="k">return</span> <span class="n">data_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.getMinVolEllipse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getMinVolEllipse</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the minimum volume ellipsoid which holds all the points</p>
<p>Based on work by Nima Moshtagh
http://www.mathworks.com/matlabcentral/fileexchange/9542
and also by looking at:
http://cctbx.sourceforge.net/current/python/scitbx.math.minimum_covering_ellipsoid.html
Which is based on the first reference anyway!</p>
<p>Here, P is a numpy array of 2 dimensional points like this:
P = [[x,y], &lt;-- one point per line
     [x,y],
     [x,y]]</p>
<p>Returns:
(center, radii, rotation): output</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getMinVolEllipse</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Find the minimum volume ellipsoid which holds all the points</span>

<span class="sd">        Based on work by Nima Moshtagh</span>
<span class="sd">        http://www.mathworks.com/matlabcentral/fileexchange/9542</span>
<span class="sd">        and also by looking at:</span>
<span class="sd">        http://cctbx.sourceforge.net/current/python/scitbx.math.minimum_covering_ellipsoid.html</span>
<span class="sd">        Which is based on the first reference anyway!</span>

<span class="sd">        Here, P is a numpy array of 2 dimensional points like this:</span>
<span class="sd">        P = [[x,y], &lt;-- one point per line</span>
<span class="sd">             [x,y],</span>
<span class="sd">             [x,y]]</span>

<span class="sd">        Returns:</span>
<span class="sd">        (center, radii, rotation): output</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="c1"># Q will be our working array</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)])</span>
        <span class="n">QT</span> <span class="o">=</span> <span class="n">Q</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># initializations</span>
        <span class="n">err</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">tolerance</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="c1"># Khachiyan Algorithm</span>
        <span class="k">while</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">QT</span><span class="p">))</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">QT</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">V</span><span class="p">),</span> <span class="n">Q</span><span class="p">)))</span>    <span class="c1"># M the diagonal vector of an NxN matrix</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">step_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span> <span class="o">-</span> <span class="n">d</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">maximum</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="n">new_u</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">step_size</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span>
            <span class="n">new_u</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_size</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">new_u</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">new_u</span>

        <span class="c1"># center of the ellipse</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>

        <span class="c1"># the A matrix for the ellipse</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">P</span><span class="p">))</span> <span class="o">-</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">center</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">center</span><span class="p">])</span>
                       <span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
        <span class="c1"># Get the values we&#39;d like to return</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="n">radii</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">radii</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.get_common_beam" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_common_beam</span><span class="p">(</span><span class="n">majs</span><span class="p">,</span> <span class="n">mins</span><span class="p">,</span> <span class="n">posas</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="s1">&#39;common&#39;</span><span class="p">,</span> <span class="n">ppe</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">plot_beams</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Derive the beam to be used for the maps to be aligned.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>majs</code></b>
              â€“
              <div class="doc-md-description">
                <p>List of Major Axis Values</p>
              </div>
            </li>
            <li>
              <b><code>mins</code></b>
              â€“
              <div class="doc-md-description">
                <p>List of Minor Axis Values</p>
              </div>
            </li>
            <li>
              <b><code>posas</code></b>
              â€“
              <div class="doc-md-description">
                <p>List of Position Angles (in degrees)</p>
              </div>
            </li>
            <li>
              <b><code>arg</code></b>
              â€“
              <div class="doc-md-description">
                <p>Type of algorithm to use ("mean", "max", "median", "circ", "common")</p>
              </div>
            </li>
            <li>
              <b><code>ppe</code></b>
              â€“
              <div class="doc-md-description">
                <p>Points per Ellipse for "common" algorithm</p>
              </div>
            </li>
            <li>
              <b><code>tolerance</code></b>
              â€“
              <div class="doc-md-description">
                <p>Tolerance parameter for "common" algorithm</p>
              </div>
            </li>
            <li>
              <b><code>plot_beams</code></b>
              â€“
              <div class="doc-md-description">
                <p>Boolean to choose if a diagnostic plot of all beams and the common beam should be displayed</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              â€“
              <div class="doc-md-description">
                <p>[maj, min, pos]: List with new major and minor axis and position angle</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_common_beam</span><span class="p">(</span><span class="n">majs</span><span class="p">,</span><span class="n">mins</span><span class="p">,</span><span class="n">posas</span><span class="p">,</span><span class="n">arg</span><span class="o">=</span><span class="s1">&#39;common&#39;</span><span class="p">,</span><span class="n">ppe</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span><span class="n">plot_beams</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Derive the beam to be used for the maps to be aligned.</span>

<span class="sd">    Args:</span>
<span class="sd">        majs: List of Major Axis Values</span>
<span class="sd">        mins: List of Minor Axis Values</span>
<span class="sd">        posas: List of Position Angles (in degrees)</span>
<span class="sd">        arg: Type of algorithm to use (&quot;mean&quot;, &quot;max&quot;, &quot;median&quot;, &quot;circ&quot;, &quot;common&quot;)</span>
<span class="sd">        ppe: Points per Ellipse for &quot;common&quot; algorithm</span>
<span class="sd">        tolerance: Tolerance parameter for &quot;common&quot; algorithm</span>
<span class="sd">        plot_beams: Boolean to choose if a diagnostic plot of all beams and the common beam should be displayed</span>

<span class="sd">    Returns:</span>
<span class="sd">        [maj, min, pos]: List with new major and minor axis and position angle</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">arg</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="n">_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">majs</span><span class="p">)</span>
        <span class="n">_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
        <span class="n">_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">posas</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Will use mean beam.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arg</span><span class="o">==</span><span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">majs</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mins</span><span class="p">):</span>
            <span class="n">beam_ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">majs</span><span class="p">)</span>
            <span class="n">_maj</span> <span class="o">=</span> <span class="n">majs</span><span class="p">[</span><span class="n">beam_ind</span><span class="p">]</span>
            <span class="n">_min</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="n">beam_ind</span><span class="p">]</span>
            <span class="n">_pos</span> <span class="o">=</span> <span class="n">posas</span><span class="p">[</span><span class="n">beam_ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not derive max beam, defaulting to common beam.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">get_common_beam</span><span class="p">(</span><span class="n">majs</span><span class="p">,</span><span class="n">mins</span><span class="p">,</span><span class="n">posas</span><span class="p">,</span><span class="n">arg</span><span class="o">=</span><span class="s2">&quot;common&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Will use max beam.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arg</span><span class="o">==</span><span class="s1">&#39;median&#39;</span><span class="p">:</span>
        <span class="n">_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">majs</span><span class="p">)</span>
        <span class="n">_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
        <span class="n">_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">posas</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Will use median beam.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
        <span class="n">_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">majs</span><span class="p">)</span>
        <span class="n">_min</span> <span class="o">=</span> <span class="n">_maj</span>
        <span class="n">_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;common&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plot_beams</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>

        <span class="n">sample_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ppe</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">majs</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">majs</span><span class="p">)):</span>
            <span class="n">bmaj</span> <span class="o">=</span> <span class="n">majs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">bmin</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">posa</span> <span class="o">=</span> <span class="n">posas</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">majs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">bmaj</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">posa</span>

            <span class="c1"># sample ellipse points</span>
            <span class="n">ellipse_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">ppe</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="o">-</span><span class="n">bmin</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ellipse_angles</span><span class="p">)</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">bmaj</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ellipse_angles</span><span class="p">)</span>

            <span class="c1"># rotate them according to position angle</span>
            <span class="n">X_rot</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">posa</span><span class="p">)</span> <span class="o">-</span> <span class="n">Y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">posa</span><span class="p">)</span>
            <span class="n">Y_rot</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">posa</span><span class="p">)</span> <span class="o">+</span> <span class="n">Y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">posa</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ppe</span><span class="p">):</span>
                <span class="n">sample_points</span><span class="p">[</span><span class="n">ind</span> <span class="o">*</span> <span class="n">ppe</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_rot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Y_rot</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">plot_beams</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_rot</span><span class="p">,</span> <span class="n">Y_rot</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

        <span class="c1"># find minimum ellipse</span>
        <span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">radii</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span> <span class="o">=</span> <span class="n">getMinVolEllipse</span><span class="p">(</span><span class="n">sample_points</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="c1"># find out bmaj, bmin and posa</span>
        <span class="n">bmaj_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">radii</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bmaj_ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bmaj</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">bmin</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radii</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">posa</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">rotation</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">-</span> <span class="mi">90</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bmaj</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radii</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">bmin</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">posa</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">rotation</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span>

        <span class="c1"># make posa from -90 to +90</span>
        <span class="k">if</span> <span class="n">posa</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">posa</span> <span class="o">=</span> <span class="n">posa</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="k">elif</span> <span class="n">posa</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">posa</span> <span class="o">=</span> <span class="n">posa</span> <span class="o">+</span> <span class="mi">180</span>

        <span class="c1"># plot ellipsoid</span>
        <span class="k">if</span> <span class="n">plot_beams</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">patches</span>
            <span class="n">ellipse</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">bmaj</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">posa</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">_maj</span> <span class="o">=</span> <span class="n">bmaj</span>
        <span class="n">_min</span> <span class="o">=</span> <span class="n">bmin</span>
        <span class="n">_pos</span> <span class="o">=</span> <span class="n">posa</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please use a valid arg value (&#39;common&#39;, &#39;max&#39;, &#39;median&#39;, &#39;mean&#39;, &#39;circ&#39;)&quot;</span><span class="p">)</span>


    <span class="n">common_beam</span><span class="o">=</span><span class="p">[</span><span class="n">_maj</span><span class="p">,</span><span class="n">_min</span><span class="p">,</span><span class="n">_pos</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> beam calculated: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span><span class="n">common_beam</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">common_beam</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.get_comp_peak_rms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_comp_peak_rms</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fits_file</span><span class="p">,</span> <span class="n">uvf_file</span><span class="p">,</span> <span class="n">mfit_file</span><span class="p">,</span> <span class="n">stokes_i_mod_file</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">uvw</span><span class="p">,</span> <span class="n">rms_box</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">difmap_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Short program to read in a .fits image and corresponding .uvfits
and .mfit file (containing Gaussian modelfits) from difmap, to estimate the
uncertainties of the modelfit components based on the image plane. This
implementation here is the best way approximating what is described in
Schinzel+ 2012, in which each component is handled individually.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>x</code></b>
                  (<code><span title="float">float</span></code>)
              â€“
              <div class="doc-md-description">
                <p>Center position in mas</p>
              </div>
            </li>
            <li>
              <b><code>y</code></b>
                  (<code><span title="float">float</span></code>)
              â€“
              <div class="doc-md-description">
                <p>Center position in mas</p>
              </div>
            </li>
            <li>
              <b><code>fits_file</code></b>
                  (<code><span title="str">str</span></code>)
              â€“
              <div class="doc-md-description">
                <p>Path to the .fits image file.</p>
              </div>
            </li>
            <li>
              <b><code>uvf_file</code></b>
                  (<code><span title="str">str</span></code>)
              â€“
              <div class="doc-md-description">
                <p>Path to the .uvfits file containing the visibilities.</p>
              </div>
            </li>
            <li>
              <b><code>mfit_file</code></b>
                  (<code><span title="str">str</span></code>)
              â€“
              <div class="doc-md-description">
                <p>Path to the text file containing the Gaussian modelfit components from difmap.</p>
              </div>
            </li>
            <li>
              <b><code>resmap_file</code></b>
                  (<code><span title="str">str</span></code>)
              â€“
              <div class="doc-md-description">
                <p>Path to the residual map (output)</p>
              </div>
            </li>
            <li>
              <b><code>weighting</code></b>
                  (<code><span title="list">list</span>[<span title="int">int</span>]</code>, default:
                      <code><span title="vcat.config.uvw">uvw</span></code>
)
              â€“
              <div class="doc-md-description">
                <p>DIFMAP uv-weighting (default: [0,-1])</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>S_p</code></b>(                  <code><span title="list">list</span></code>
)              â€“
              <div class="doc-md-description">
                <p>List with peak flux densities for each component in mJy/beam.</p>
              </div>
            </li>
            <li>
<b><code>rms</code></b>(                  <code><span title="list">list</span></code>
)              â€“
              <div class="doc-md-description">
                <p>List with residual image root-mean square for each
component in mJy/beam.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_comp_peak_rms</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fits_file</span><span class="p">,</span> <span class="n">uvf_file</span><span class="p">,</span> <span class="n">mfit_file</span><span class="p">,</span> <span class="n">stokes_i_mod_file</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="n">weighting</span><span class="o">=</span><span class="n">uvw</span><span class="p">,</span> <span class="n">rms_box</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">difmap_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Short program to read in a .fits image and corresponding .uvfits</span>
<span class="sd">    and .mfit file (containing Gaussian modelfits) from difmap, to estimate the</span>
<span class="sd">    uncertainties of the modelfit components based on the image plane. This</span>
<span class="sd">    implementation here is the best way approximating what is described in</span>
<span class="sd">    Schinzel+ 2012, in which each component is handled individually.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (float): Center position in mas</span>
<span class="sd">        y (float): Center position in mas</span>
<span class="sd">        fits_file (str): Path to the .fits image file.</span>
<span class="sd">        uvf_file (str): Path to the .uvfits file containing the visibilities.</span>
<span class="sd">        mfit_file (str): Path to the text file containing the Gaussian modelfit components from difmap.</span>
<span class="sd">        resmap_file (str): Path to the residual map (output)</span>
<span class="sd">        weighting (list[int]): DIFMAP uv-weighting (default: [0,-1])</span>

<span class="sd">    Returns:</span>
<span class="sd">        S_p (list): List with peak flux densities for each component in mJy/beam.</span>
<span class="sd">        rms (list): List with residual image root-mean square for each</span>
<span class="sd">          component in mJy/beam.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># add difmap to PATH</span>
    <span class="k">if</span> <span class="n">difmap_path</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">difmap_path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">difmap_path</span><span class="p">)</span>

    <span class="c1"># remove potential difmap boot files (we don&#39;t need them)</span>
    <span class="n">env</span><span class="p">[</span><span class="s2">&quot;DIFMAP_LOGIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Initialize difmap call</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;difmap&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="n">child</span><span class="o">.</span><span class="n">expect_exact</span><span class="p">(</span><span class="s1">&#39;0&gt;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_difmap_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span><span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;0&gt;&#39;</span><span class="p">):</span>
        <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">expect_exact</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># print(&#39;Using .fits and .uvf file&#39;)</span>
    <span class="n">ms_x</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">,</span> <span class="n">ms_y</span><span class="p">,</span> <span class="n">ps_y</span> <span class="o">=</span> <span class="n">get_ms_ps</span><span class="p">(</span><span class="n">fits_file</span><span class="p">)</span>


    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;observe &#39;</span> <span class="o">+</span> <span class="n">uvf_file</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;select I&#39;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;uvw &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">weighting</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">weighting</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>    <span class="c1"># use natural weighting as default</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;rmod &#39;</span> <span class="o">+</span> <span class="n">stokes_i_mod_file</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;selfcal&#39;</span><span class="p">)</span> <span class="c1">#this is required in case the map is shifted (difmap does not store phase shifts!)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;select &#39;</span> <span class="o">+</span>  <span class="n">channel</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;rmod &#39;</span> <span class="o">+</span> <span class="n">mfit_file</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s2">&quot;selfcal&quot;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;mapsize &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ms_x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ps_x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ms_y</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ps_y</span><span class="p">))</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wdmap tmp/resmap_model.fits&#39;</span><span class="p">)</span>
    <span class="n">ra</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">y</span>

    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;dev /NULL&#39;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;mapl cln&#39;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;addwin &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ra</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">ps_x</span><span class="p">)</span>
                             <span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ra</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">ps_x</span><span class="p">)</span>
                             <span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dec</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">ps_y</span><span class="p">)</span>
                             <span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dec</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">ps_y</span><span class="p">))</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;winmod true&#39;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;mapl map&#39;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;print mapvalue(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
                                     <span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -rf difmap.log*&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">str_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">str_</span> <span class="o">==</span><span class="s1">&#39;.&#39;</span><span class="p">:</span>
                <span class="n">j_end</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">break</span>
        <span class="n">S_p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">[</span><span class="o">-</span><span class="n">j_end</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not read off peak flux density for component.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
        <span class="n">S_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">rms</span> <span class="o">=</span> <span class="n">get_noise_from_residual_map</span><span class="p">(</span><span class="s2">&quot;tmp/resmap_model.fits&quot;</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">rms_box</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">S_p</span><span class="p">,</span> <span class="n">rms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.get_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_date</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the date of an observation from a .fits file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path to the .fits file</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              â€“
              <div class="doc-md-description">
                <p>Date in the format year-month-day</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_date</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the date of an observation from a .fits file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Path to the .fits file</span>

<span class="sd">    Returns:</span>
<span class="sd">        Date in the format year-month-day</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hdu_list</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Plot date</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">hdu_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;DATE-OBS&quot;</span><span class="p">]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">day</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">day</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">month</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">month</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">45</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;19&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">46</span><span class="p">:</span>
                    <span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;20&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">day</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">hdu_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;MJD&quot;</span><span class="p">]</span>
        <span class="n">date</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">date</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.get_noise_from_residual_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_noise_from_residual_map</span><span class="p">(</span><span class="n">residual_fits</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">rms_box</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>calculates the noise from the residual map in a given box</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>residual_fits</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path to .fits file with residual map</p>
              </div>
            </li>
            <li>
              <b><code>center_x</code></b>
              â€“
              <div class="doc-md-description">
                <p>X-center of the box to use for noise calculation in mas</p>
              </div>
            </li>
            <li>
              <b><code>center_y</code></b>
              â€“
              <div class="doc-md-description">
                <p>Y-center of the box to use for noise calculation in mas</p>
              </div>
            </li>
            <li>
              <b><code>rms_box</code></b>
              â€“
              <div class="doc-md-description">
                <p>Width of the box in pixels</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>noise</code></b>(                  <code><span title="float">float</span></code>
)              â€“
              <div class="doc-md-description">
                <p>Noise in the given box from the residual map</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_noise_from_residual_map</span><span class="p">(</span><span class="n">residual_fits</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">rms_box</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculates the noise from the residual map in a given box</span>

<span class="sd">    Args:</span>
<span class="sd">        residual_fits: Path to .fits file with residual map</span>
<span class="sd">        center_x: X-center of the box to use for noise calculation in mas</span>
<span class="sd">        center_y: Y-center of the box to use for noise calculation in mas</span>
<span class="sd">        rms_box: Width of the box in pixels</span>

<span class="sd">    Returns:</span>
<span class="sd">        noise (float): Noise in the given box from the residual map</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ms_x</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">,</span> <span class="n">ms_y</span><span class="p">,</span> <span class="n">ps_y</span> <span class="o">=</span> <span class="n">get_ms_ps</span><span class="p">(</span><span class="n">residual_fits</span><span class="p">)</span>
    <span class="n">resMAP_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">residual_fits</span><span class="p">)</span>
    <span class="n">resMAP_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">resMAP_data</span><span class="p">)</span>
    <span class="n">xdim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resMAP_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ydim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resMAP_data</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s2">&quot;std&quot;</span><span class="p">:</span>
        <span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">resMAP_data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ydim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">center_y</span> <span class="o">/</span> <span class="n">ps_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                                 <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ydim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">center_y</span> <span class="o">/</span> <span class="n">ps_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                     <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">xdim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">center_x</span> <span class="o">/</span> <span class="n">ps_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                     <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">xdim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">center_x</span> <span class="o">/</span> <span class="n">ps_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s2">&quot;aver&quot;</span><span class="p">:</span>
        <span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">resMAP_data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ydim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">center_y</span> <span class="o">/</span> <span class="n">ps_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                                 <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ydim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">center_y</span> <span class="o">/</span> <span class="n">ps_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                     <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">xdim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">center_x</span> <span class="o">/</span> <span class="n">ps_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                     <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">xdim</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">center_x</span> <span class="o">/</span> <span class="n">ps_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">rms_box</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">rms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.get_residual_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_residual_map</span><span class="p">(</span><span class="n">uvf_file</span><span class="p">,</span> <span class="n">mod_file</span><span class="p">,</span> <span class="n">clean_mod_file</span><span class="p">,</span> <span class="n">difmap_path</span><span class="o">=</span><span class="n">difmap_path</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">save_location</span><span class="o">=</span><span class="s1">&#39;residual.fits&#39;</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">uvw</span><span class="p">,</span> <span class="n">npix</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">pxsize</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">do_selfcal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>calculates residual map and stores it as .fits file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uvf_file</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path to a .uvf file</p>
              </div>
            </li>
            <li>
              <b><code>mod_file</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path to a .mod file</p>
              </div>
            </li>
            <li>
              <b><code>difmap_path</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path to the DIFMAP executable</p>
              </div>
            </li>
            <li>
              <b><code>save_location</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path where to store the residual map .fits file</p>
              </div>
            </li>
            <li>
              <b><code>npix</code></b>
              â€“
              <div class="doc-md-description">
                <p>Number of pixels to use</p>
              </div>
            </li>
            <li>
              <b><code>pxsize</code></b>
              â€“
              <div class="doc-md-description">
                <p>Pixel Size (usually in mas)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              â€“
              <div class="doc-md-description">
                <p>Nothing, but writes a .fits file including the residual map</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_residual_map</span><span class="p">(</span><span class="n">uvf_file</span><span class="p">,</span><span class="n">mod_file</span><span class="p">,</span> <span class="n">clean_mod_file</span><span class="p">,</span> <span class="n">difmap_path</span><span class="o">=</span><span class="n">difmap_path</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">save_location</span><span class="o">=</span><span class="s2">&quot;residual.fits&quot;</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">uvw</span><span class="p">,</span>
                     <span class="n">npix</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span><span class="n">pxsize</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">do_selfcal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; calculates residual map and stores it as .fits file.</span>

<span class="sd">    Args:</span>
<span class="sd">        uvf_file: Path to a .uvf file</span>
<span class="sd">        mod_file: Path to a .mod file</span>
<span class="sd">        difmap_path: Path to the DIFMAP executable</span>
<span class="sd">        save_location: Path where to store the residual map .fits file</span>
<span class="sd">        npix: Number of pixels to use</span>
<span class="sd">        pxsize: Pixel Size (usually in mas)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Nothing, but writes a .fits file including the residual map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># add difmap to PATH</span>
    <span class="k">if</span> <span class="n">difmap_path</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">difmap_path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">difmap_path</span><span class="p">)</span>

    <span class="c1">#remove potential difmap boot files (we don&#39;t need them)</span>
    <span class="n">env</span><span class="p">[</span><span class="s2">&quot;DIFMAP_LOGIN&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="c1"># Initialize difmap call</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;difmap&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="n">child</span><span class="o">.</span><span class="n">expect_exact</span><span class="p">(</span><span class="s2">&quot;0&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_difmap_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;0&gt;&quot;</span><span class="p">):</span>
        <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">expect_exact</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s2">&quot;obs &quot;</span><span class="o">+</span><span class="n">uvf_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_selfcal</span><span class="p">:</span>
        <span class="n">send_difmap_command</span><span class="p">(</span><span class="s2">&quot;select i&quot;</span><span class="p">)</span>
        <span class="n">send_difmap_command</span><span class="p">(</span><span class="s2">&quot;rmod &quot;</span> <span class="o">+</span> <span class="n">clean_mod_file</span><span class="p">)</span>
        <span class="n">send_difmap_command</span><span class="p">(</span><span class="s2">&quot;selfcal&quot;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;select </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rmod </span><span class="si">{</span><span class="n">mod_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s1">&#39;uvw &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">weighting</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">weighting</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># use natural weighting</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s2">&quot;maps &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">npix</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pxsize</span><span class="p">))</span>
    <span class="n">send_difmap_command</span><span class="p">(</span><span class="s2">&quot;wdmap &quot;</span> <span class="o">+</span> <span class="n">save_location</span><span class="p">)</span> <span class="c1">#save the residual map to a fits file</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -rf difmap.log*&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.get_uvf_frequency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_uvf_frequency</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts frequency from the FITS header by finding the correct CVALX.</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_uvf_frequency</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts frequency from the FITS header by finding the correct CVALX.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu_list</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>  <span class="c1"># Check CTYPE1 to CTYPE99 (assuming X is within this range)</span>
            <span class="n">ctype_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CTYPE</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cval_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CRVAL</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">ctype_key</span> <span class="ow">in</span> <span class="n">header</span> <span class="ow">and</span> <span class="s2">&quot;FREQ&quot;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="n">ctype_key</span><span class="p">]:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="n">cval_key</span><span class="p">])</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frequency keyword not found in </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.mas2pc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mas2pc</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>To convert mas to parsec.</p>
<p>Uses either a redshift (z) or a distance (d) to compute the conversion from mas to parsec.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>z</code></b>
                  (<code><span title="float">float</span></code>, default:
                      <code>None</code>
)
              â€“
              <div class="doc-md-description">
                <p>redshift</p>
              </div>
            </li>
            <li>
              <b><code>d</code></b>
                  (<code><span title="float">float</span></code>, default:
                      <code>None</code>
)
              â€“
              <div class="doc-md-description">
                <p>distance</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>result</code></b>(                  <code><span title="float">float</span></code>
)              â€“
              <div class="doc-md-description">
                <p>the conversion between mas and parsec.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mas2pc</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;To convert mas to parsec.</span>

<span class="sd">    Uses either a redshift (z) or a distance (d) to compute the conversion from mas to parsec.</span>

<span class="sd">    Args:</span>
<span class="sd">        z (float): redshift</span>
<span class="sd">        d (float): distance</span>

<span class="sd">    Returns:</span>
<span class="sd">        result (float): the conversion between mas and parsec.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cosmo</span><span class="o">=</span><span class="n">FlatLambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="n">H0</span><span class="p">,</span><span class="n">Om0</span><span class="o">=</span><span class="n">Om0</span><span class="p">)</span> <span class="c1">#Planck Collaboration 2020</span>

    <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">D</span><span class="o">=</span><span class="n">d</span><span class="o">*</span><span class="mf">1e6</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">parsec</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">D</span><span class="o">=</span><span class="n">cosmo</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="o">/</span><span class="mf">3.6e6</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">parsec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.plot_pixel_fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_pixel_fit</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">brightness</span><span class="p">,</span> <span class="n">err_brightness</span><span class="p">,</span> <span class="n">fitted_func</span><span class="p">,</span> <span class="n">pixel</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">peak_brightness</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the data points and fitted function for a specific pixel.</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_pixel_fit</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">brightness</span><span class="p">,</span> <span class="n">err_brightness</span><span class="p">,</span> <span class="n">fitted_func</span><span class="p">,</span> <span class="n">pixel</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">peak_brightness</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the data points and fitted function for a specific pixel.&quot;&quot;&quot;</span>
    <span class="n">x_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">frequencies</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">frequencies</span><span class="p">),</span> <span class="mi">10000</span><span class="p">)</span>  <span class="c1"># High-resolution x-axis</span>
    <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">func_turn</span><span class="p">(</span><span class="n">x_smooth</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>  <span class="c1"># Fitted function for high-res x-axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">brightness</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">err_brightness</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Points&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_smooth</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Fitted Function</span><span class="se">\n</span><span class="s1">Peak: </span><span class="si">{</span><span class="n">peak_brightness</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GHz&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [GHz]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Brightness [Jy/beam]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pixel (</span><span class="si">{</span><span class="n">pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="c1">#plt.savefig(f&#39;pixel_fit_{pixel[1]}_{pixel[0]}.pdf&#39;, format=&#39;pdf&#39;, dpi=300, bbox_inches=&#39;tight&#39;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.rotate_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rotate_points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Rotate points (x, y) by angle (in degrees) around the origin.</p>


            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rotate_points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Rotate points (x, y) by angle (in degrees) around the origin. &quot;&quot;&quot;</span>
    <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span>  <span class="c1"># Convert degrees to radians</span>
    <span class="n">cos_theta</span><span class="p">,</span> <span class="n">sin_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>

    <span class="c1"># Apply rotation matrix</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">cos_theta</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">sin_theta</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">sin_theta</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">cos_theta</span> <span class="o">*</span> <span class="n">y</span>

    <span class="k">return</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.set_figsize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_figsize</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ratio</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set aesthetic figure dimensions to avoid scaling in latex.
Taken from https://jwalton.info/Embed-Publication-Matplotlib-Latex/</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>width</code></b>
                  (<code><span title="float">float</span> or <span title="string">string</span></code>)
              â€“
              <div class="doc-md-description">
                <p>Width in pts, or string of predined document type</p>
              </div>
            </li>
            <li>
              <b><code>fraction</code></b>
                  (<code>(<span title="float">float</span>, <span title="optional">optional</span>)</code>, default:
                      <code>1</code>
)
              â€“
              <div class="doc-md-description">
                <p>Fraction of the width which you wish the figure to occupy</p>
              </div>
            </li>
            <li>
              <b><code>subplots</code></b>
                  (<code><span title="tuple">tuple</span>(<span title="int">int</span>)</code>, default:
                      <code>(1, 1)</code>
)
              â€“
              <div class="doc-md-description">
                <p>The number of rows and columns of subplots</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>fig_dim</code></b>(                  <code><span title="tuple">tuple</span></code>
)              â€“
              <div class="doc-md-description">
                <p>Dimensions of figure in inches</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_figsize</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">subplots</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ratio</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Set aesthetic figure dimensions to avoid scaling in latex.</span>
<span class="sd">    Taken from https://jwalton.info/Embed-Publication-Matplotlib-Latex/</span>

<span class="sd">    Args:</span>
<span class="sd">        width (float or string): Width in pts, or string of predined document type</span>
<span class="sd">        fraction (float,optional): Fraction of the width which you wish the figure to occupy</span>
<span class="sd">        subplots (tuple(int)): The number of rows and columns of subplots</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig_dim (tuple): Dimensions of figure in inches</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">width</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">width</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fraction</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">width</span> <span class="o">==</span><span class="s1">&#39;aanda&#39;</span><span class="p">:</span>
        <span class="n">width_pt</span> <span class="o">=</span> <span class="mf">256.0748</span>
    <span class="k">elif</span> <span class="n">width</span> <span class="o">==</span><span class="s1">&#39;aanda*&#39;</span><span class="p">:</span>
        <span class="n">width_pt</span> <span class="o">=</span> <span class="mf">523.5307</span>
    <span class="k">elif</span> <span class="n">width</span> <span class="o">==</span> <span class="s1">&#39;beamer&#39;</span><span class="p">:</span>
        <span class="n">width_pt</span> <span class="o">=</span> <span class="mi">342</span>
    <span class="k">elif</span> <span class="n">width</span> <span class="o">==</span> <span class="s1">&#39;screen&#39;</span><span class="p">:</span>
        <span class="n">width_pt</span> <span class="o">=</span> <span class="mi">600</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width_pt</span> <span class="o">=</span> <span class="n">width</span>
    <span class="c1"># Width of figure</span>
    <span class="n">fig_width_pt</span> <span class="o">=</span> <span class="n">width_pt</span> <span class="o">*</span> <span class="n">fraction</span>

    <span class="c1"># Convert from pt to inches</span>
    <span class="n">inches_per_pt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">72.27</span>

    <span class="c1"># Golden ratio to set aesthetic figure height</span>
    <span class="n">golden_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ratio</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">golden_ratio</span>

    <span class="c1"># Figure width in inches</span>
    <span class="n">fig_width_in</span> <span class="o">=</span> <span class="n">fig_width_pt</span> <span class="o">*</span> <span class="n">inches_per_pt</span>
    <span class="c1"># Figure height in inches</span>
    <span class="n">fig_height_in</span> <span class="o">=</span> <span class="n">fig_width_in</span> <span class="o">*</span> <span class="n">ratio</span><span class="o">*</span> <span class="p">(</span><span class="n">subplots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">subplots</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">fig_width_in</span><span class="p">,</span> <span class="n">fig_height_in</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.total_flux_from_mod" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">total_flux_from_mod</span><span class="p">(</span><span class="n">mod_file</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>needs a mod_file as input an returns the total flux</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>mod_file</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path to a .mod file</p>
              </div>
            </li>
            <li>
              <b><code>squared</code></b>
              â€“
              <div class="doc-md-description">
                <p>If true, returns the sum of the squared fluxes (useful for polarization)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              â€“
              <div class="doc-md-description">
                <p>The total flux in the .mod file (usually in mJy, depending on the .mod file)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">total_flux_from_mod</span><span class="p">(</span><span class="n">mod_file</span><span class="p">,</span><span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;needs a mod_file as input an returns the total flux</span>

<span class="sd">    Args:</span>
<span class="sd">        mod_file: Path to a .mod file</span>
<span class="sd">        squared: If true, returns the sum of the squared fluxes (useful for polarization)</span>

<span class="sd">    Returns:</span>
<span class="sd">        The total flux in the .mod file (usually in mJy, depending on the .mod file)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lines</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">mod_file</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">total_flux</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
            <span class="n">linepart</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">squared</span><span class="p">:</span>
                <span class="n">total_flux</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_flux</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">linepart</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">total_flux</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.wrap_evpas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_evpas</span><span class="p">(</span><span class="n">evpas</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Checks for EVPA changes &gt;90 or &lt;-90 degreees and wraps them</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>evpas</code></b>
                  (<code><span title="list">list</span>[<span title="float">float</span>]</code>)
              â€“
              <div class="doc-md-description">
                <p>List of EVPA values in degrees</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>evpas</code></b>(                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
)              â€“
              <div class="doc-md-description">
                <p>List of wrapped EVPAs</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wrap_evpas</span><span class="p">(</span><span class="n">evpas</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks for EVPA changes &gt;90 or &lt;-90 degreees and wraps them</span>

<span class="sd">    Args:</span>
<span class="sd">        evpas (list[float]): List of EVPA values in degrees</span>

<span class="sd">    Returns:</span>
<span class="sd">        evpas (list[float]): List of wrapped EVPAs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">evpas</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">evpas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">evpas</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">evpas</span><span class="p">)):</span>
                    <span class="n">evpas</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">180</span>
            <span class="k">if</span> <span class="n">evpas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">evpas</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">evpas</span><span class="p">)):</span>
                    <span class="n">evpas</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">180</span>
    <span class="k">return</span> <span class="n">evpas</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.write_mod_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_mod_file</span><span class="p">(</span><span class="n">model_df</span><span class="p">,</span> <span class="n">writepath</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">adv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>writes a .mod file given an input DataFrame with component info.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>model_df</code></b>
              â€“
              <div class="doc-md-description">
                <p>DataFrame with model component info (e.g. generated by getComponentInfo())</p>
              </div>
            </li>
            <li>
              <b><code>writepath</code></b>
              â€“
              <div class="doc-md-description">
                <p>Filepath where to write the .mod file</p>
              </div>
            </li>
            <li>
              <b><code>freq</code></b>
              â€“
              <div class="doc-md-description">
                <p>Frequency of the observation in GHz</p>
              </div>
            </li>
            <li>
              <b><code>scale</code></b>
              â€“
              <div class="doc-md-description">
                <p>Conversion of the image scale to degrees (default milli-arc-seconds -&gt; 60<em>60</em>1000)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              â€“
              <div class="doc-md-description">
                <p>Nothing, but writes a .mod file to writepath</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_mod_file</span><span class="p">(</span><span class="n">model_df</span><span class="p">,</span><span class="n">writepath</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="n">adv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;writes a .mod file given an input DataFrame with component info.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_df: DataFrame with model component info (e.g. generated by getComponentInfo())</span>
<span class="sd">        writepath: Filepath where to write the .mod file</span>
<span class="sd">        freq: Frequency of the observation in GHz</span>
<span class="sd">        scale: Conversion of the image scale to degrees (default milli-arc-seconds -&gt; 60*60*1000)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Nothing, but writes a .mod file to writepath</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_df</span><span class="p">[</span><span class="s2">&quot;Flux&quot;</span><span class="p">])</span>
    <span class="n">delta_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_df</span><span class="p">[</span><span class="s2">&quot;Delta_x&quot;</span><span class="p">])</span>
    <span class="n">delta_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_df</span><span class="p">[</span><span class="s2">&quot;Delta_y&quot;</span><span class="p">])</span>
    <span class="n">maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_df</span><span class="p">[</span><span class="s2">&quot;Major_axis&quot;</span><span class="p">])</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_df</span><span class="p">[</span><span class="s2">&quot;Minor_axis&quot;</span><span class="p">])</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_df</span><span class="p">[</span><span class="s2">&quot;PA&quot;</span><span class="p">])</span>
    <span class="n">typ_obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_df</span><span class="p">[</span><span class="s2">&quot;Typ_obj&quot;</span><span class="p">])</span>

    <span class="n">original_stdout</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">writepath</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">radius</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">theta</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">ratio</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">)):</span>
        <span class="n">radius</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span><span class="o">+</span><span class="mi">180</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">/</span> <span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">delta_x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">delta_y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maj</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ratio_val</span><span class="o">=</span><span class="nb">min</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">maj</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ratio_val</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1">#swap maj and min if needed</span>
                <span class="n">m</span><span class="o">=</span><span class="n">maj</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">maj</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="nb">min</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="nb">min</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">m</span>
                <span class="n">pos</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">pos</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">+</span><span class="mi">90</span>
            <span class="n">ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">maj</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#sort by flux</span>
    <span class="n">argsort</span><span class="o">=</span><span class="n">flux</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">flux</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)[</span><span class="n">argsort</span><span class="p">]</span>
    <span class="n">radius</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">radius</span><span class="p">)[</span><span class="n">argsort</span><span class="p">]</span>
    <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">theta</span><span class="p">)[</span><span class="n">argsort</span><span class="p">]</span>
    <span class="n">maj</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maj</span><span class="p">)[</span><span class="n">argsort</span><span class="p">]</span>
    <span class="n">ratio</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ratio</span><span class="p">)[</span><span class="n">argsort</span><span class="p">]</span>
    <span class="n">pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)[</span><span class="n">argsort</span><span class="p">]</span>
    <span class="n">typ_obj</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">typ_obj</span><span class="p">)[</span><span class="n">argsort</span><span class="p">]</span>

    <span class="c1">#check if we need to add &quot;v&quot; to the components to make them fittable</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adv</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">ad</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ads</span> <span class="ow">in</span> <span class="n">adv</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ads</span><span class="p">:</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">adv</span><span class="p">)</span><span class="o">!=</span><span class="mi">6</span><span class="p">:</span>
            <span class="c1">#make sure ad has seven elements</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">adv</span><span class="p">)):</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">adv</span><span class="p">:</span>
        <span class="n">ad</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ad</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">+</span><span class="n">ad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;   &quot;</span><span class="o">+</span>
              <span class="s2">&quot;</span><span class="si">{:.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">radius</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">+</span><span class="n">ad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;    &quot;</span><span class="o">+</span>
              <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">+</span><span class="n">ad</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;   &quot;</span><span class="o">+</span>
              <span class="s2">&quot;</span><span class="si">{:.7f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maj</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span><span class="o">+</span><span class="n">ad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;    &quot;</span><span class="o">+</span>
              <span class="s2">&quot;</span><span class="si">{:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">+</span><span class="n">ad</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;   &quot;</span><span class="o">+</span>
              <span class="s2">&quot;</span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">+</span><span class="n">ad</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;  &quot;</span><span class="o">+</span>
              <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">typ_obj</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span>
              <span class="s2">&quot;</span><span class="si">{:.5E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;   0&quot;</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">original_stdout</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.write_mod_file_from_casa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_mod_file_from_casa</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">export</span><span class="o">=</span><span class="s1">&#39;export.mod&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Writes a .mod file from a CASA exported .fits model file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_path</code></b>
              â€“
              <div class="doc-md-description">
                <p>Image_data object</p>
              </div>
            </li>
            <li>
              <b><code>channel</code></b>
              â€“
              <div class="doc-md-description">
                <p>Choose the Stokes channel to use (options: "i","q","u","v")</p>
              </div>
            </li>
            <li>
              <b><code>export</code></b>
              â€“
              <div class="doc-md-description">
                <p>File path where to write the .mod file</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              â€“
              <div class="doc-md-description">
                <p>Nothing, but writes a .mod file to export</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_mod_file_from_casa</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="n">export</span><span class="o">=</span><span class="s2">&quot;export.mod&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes a .mod file from a CASA exported .fits model file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Image_data object</span>
<span class="sd">        channel: Choose the Stokes channel to use (options: &quot;i&quot;,&quot;q&quot;,&quot;u&quot;,&quot;v&quot;)</span>
<span class="sd">        export: File path where to write the .mod file</span>

<span class="sd">    Returns:</span>
<span class="sd">        Nothing, but writes a .mod file to export</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">channel</span><span class="o">==</span><span class="s2">&quot;i&quot;</span><span class="p">:</span>
        <span class="n">clean_map</span><span class="o">=</span><span class="n">image_data</span><span class="o">.</span><span class="n">Z</span>
    <span class="k">elif</span> <span class="n">channel</span><span class="o">==</span><span class="s2">&quot;q&quot;</span><span class="p">:</span>
        <span class="n">clean_map</span><span class="o">=</span><span class="n">image_data</span><span class="o">.</span><span class="n">stokes_q</span>
    <span class="k">elif</span> <span class="n">channel</span><span class="o">==</span><span class="s2">&quot;u&quot;</span><span class="p">:</span>
        <span class="n">clean_map</span><span class="o">=</span><span class="n">image_data</span><span class="o">.</span><span class="n">stokes_u</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please enter a valid channel (i,q,u)&quot;</span><span class="p">)</span>

    <span class="c1">#read out clean components from pixel map</span>
    <span class="n">delta_x</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">delta_y</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">flux</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">zeros</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_data</span><span class="o">.</span><span class="n">X</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_data</span><span class="o">.</span><span class="n">Y</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">clean_map</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">delta_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_data</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">image_data</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">delta_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_data</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">image_data</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">flux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clean_map</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1">#create model_df</span>
    <span class="n">model_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;Flux&#39;</span><span class="p">:</span> <span class="n">flux</span><span class="p">,</span>
         <span class="s1">&#39;Delta_x&#39;</span><span class="p">:</span> <span class="n">delta_x</span><span class="p">,</span>
         <span class="s1">&#39;Delta_y&#39;</span><span class="p">:</span> <span class="n">delta_y</span><span class="p">,</span>
         <span class="s1">&#39;Major_axis&#39;</span><span class="p">:</span> <span class="n">zeros</span><span class="p">,</span>
         <span class="s1">&#39;Minor_axis&#39;</span><span class="p">:</span> <span class="n">zeros</span><span class="p">,</span>
         <span class="s1">&#39;PA&#39;</span><span class="p">:</span> <span class="n">zeros</span><span class="p">,</span>
         <span class="s1">&#39;Typ_obj&#39;</span><span class="p">:</span> <span class="n">zeros</span>
         <span class="p">})</span>

    <span class="c1">#create mod file</span>
    <span class="n">write_mod_file</span><span class="p">(</span><span class="n">model_df</span><span class="p">,</span><span class="n">export</span><span class="p">,</span><span class="n">image_data</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="n">image_data</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="vcat.helpers.write_mod_file_from_components" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_mod_file_from_components</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">export</span><span class="o">=</span><span class="s1">&#39;export.mod&#39;</span><span class="p">,</span> <span class="n">adv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Writes a .mod file from a given list of component objects</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>components</code></b>
                  (<code><span title="list">list</span>[<span title="Component">Component</span>]</code>)
              â€“
              <div class="doc-md-description">
                <p>List of component objects to include in the .mod file</p>
              </div>
            </li>
            <li>
              <b><code>channel</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;i&#39;</code>
)
              â€“
              <div class="doc-md-description">
                <p>polarization channel ("I","Q","U")</p>
              </div>
            </li>
            <li>
              <b><code>export</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;export.mod&#39;</code>
)
              â€“
              <div class="doc-md-description">
                <p>file path of the .mod file to be created</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>vcat/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_mod_file_from_components</span><span class="p">(</span><span class="n">components</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="n">export</span><span class="o">=</span><span class="s2">&quot;export.mod&quot;</span><span class="p">,</span><span class="n">adv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a .mod file from a given list of component objects</span>

<span class="sd">    Args:</span>
<span class="sd">        components (list[Component]): List of component objects to include in the .mod file</span>
<span class="sd">        channel (str): polarization channel (&quot;I&quot;,&quot;Q&quot;,&quot;U&quot;)</span>
<span class="sd">        export (str): file path of the .mod file to be created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">delta_x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">delta_y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">maj</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">typ_obj</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="s2">&quot;I&quot;</span><span class="p">]:</span>
            <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span><span class="n">comp</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta_x</span><span class="p">,</span><span class="n">comp</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta_y</span><span class="p">,</span><span class="n">comp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maj</span><span class="p">,</span><span class="n">comp</span><span class="o">.</span><span class="n">maj</span><span class="p">)</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="n">comp</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">typ_obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typ_obj</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#for gauss component</span>

        <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span><span class="s2">&quot;U&quot;</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">,</span><span class="s2">&quot;U&quot;</span><span class="p">]:</span>
            <span class="c1">#calculate U and Q flux from lin_pol and evpa</span>
            <span class="n">chi</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">evpa</span>
            <span class="k">if</span> <span class="n">chi</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">chi</span> <span class="o">-=</span> <span class="mi">180</span>
            <span class="k">if</span> <span class="n">chi</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                <span class="n">chi</span> <span class="o">+=</span> <span class="mi">180</span>
            <span class="k">if</span> <span class="n">chi</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">chi</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
                <span class="n">pre_q</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
                <span class="n">pre_u</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">chi</span> <span class="o">&gt;=</span> <span class="mi">45</span> <span class="ow">and</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">pre_u</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
                <span class="n">pre_q</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">chi</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">45</span><span class="p">:</span>
                <span class="n">pre_q</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
                <span class="n">pre_u</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">45</span> <span class="ow">and</span> <span class="n">chi</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                <span class="n">pre_q</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">pre_u</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="n">chi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">comp</span><span class="o">.</span><span class="n">evpa</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">pre_u</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span> <span class="o">*</span> <span class="n">comp</span><span class="o">.</span><span class="n">lin_pol</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">pre_q</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">lin_pol</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;q&quot;</span><span class="p">,</span><span class="s2">&quot;Q&quot;</span><span class="p">]:</span>
                <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>

    <span class="n">model_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Flux&quot;</span><span class="p">:</span> <span class="n">flux</span><span class="p">,</span>
                             <span class="s2">&quot;Delta_x&quot;</span><span class="p">:</span> <span class="n">delta_x</span><span class="p">,</span>
                             <span class="s2">&quot;Delta_y&quot;</span><span class="p">:</span> <span class="n">delta_y</span><span class="p">,</span>
                             <span class="s2">&quot;Major_axis&quot;</span><span class="p">:</span> <span class="n">maj</span><span class="p">,</span>
                             <span class="s2">&quot;Minor_axis&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span>
                             <span class="s2">&quot;PA&quot;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span>
                             <span class="s2">&quot;Typ_obj&quot;</span><span class="p">:</span> <span class="n">typ_obj</span><span class="p">})</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">write_mod_file</span><span class="p">(</span><span class="n">model_df</span><span class="p">,</span><span class="n">export</span><span class="p">,</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span><span class="n">adv</span><span class="o">=</span><span class="n">adv</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="imagecube.html" class="btn btn-neutral float-left" title="ImageCube"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="license.html" class="btn btn-neutral float-right" title="License">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/mpifr-vlbi/VCAT/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="imagecube.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="license.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
